<!doctype html>

<html lang="en">

<head>

  <meta charset="utf-8">

  <title>PorchMe – Admin Gallery</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://upload-widget.cloudinary.com/global/all.js" defer></script>

  <style>

    body{background:#0e2340;color:#fff;font-family:system-ui,Segoe UI,Roboto,Arial}

    .wrap{max-width:560px;margin:40px auto;padding:24px;border:1px solid rgba(255,255,255,.15);border-radius:12px;background:rgba(255,255,255,.03)}

    h2{margin-top:0}

    button{padding:12px 18px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:#1b396b;color:#fff;font-weight:600;cursor:pointer}

    input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.06);color:#fff}

    .row{margin:12px 0}

    .thumb img{max-width:100%;border-radius:10px;border:1px solid rgba(255,255,255,.15)}

    .note{opacity:.85;font-size:.9rem;margin-top:8px}

  </style>

</head>

<body>

<div class="wrap">

  <h2>Admin – Upload to Gallery</h2>



  <div class="row">

    <input id="adminPass" type="password" placeholder="Enter admin password">

  </div>



  <div class="row">

    <input id="title" type="text" placeholder="Optional title (e.g., 'Porch example 7')">

  </div>



  <div class="row">

    <button id="uploadBtn">Upload Image</button>

    <div class="note">JPG/PNG/WebP. Large files will be auto-optimized.</div>

  </div>



  <div class="thumb" id="preview"></div>

</div>



<script>

  // === CONFIG – بدّل القيم حسب حسابك في Cloudinary ===

  const CLOUD_NAME = "YOUR_CLOUD_NAME";        // مثال: porchme

  const UPLOAD_PRESET = "porchme_unsigned";    // Unsigned preset من Cloudinary

  // رابط الويب-آب الذي أعطيتني إياه:

  const SHEET_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbw0N3eKY62Z4q8UnH0FEhRmi3_7jQGuwclHtsU0IgB_mLbWDHW2cnpp64LBW7F6Gnq3/exec";

  const ADMIN_PASSWORD = "PorchMe2025";        // غيّرها فوراً (لاحقاً نعمل Token أقوى)



  const passInput = document.getElementById('adminPass');

  const titleInput = document.getElementById('title');

  const preview = document.getElementById('preview');

  const uploadBtn = document.getElementById('uploadBtn');



  function isAuthed(){ return passInput.value === ADMIN_PASSWORD; }



  uploadBtn.addEventListener('click', () => {

    if(!isAuthed()){ alert("Wrong password."); return; }



    const widget = cloudinary.createUploadWidget({

      cloudName: CLOUD_NAME,

      uploadPreset: UPLOAD_PRESET,

      sources: ['local','url','camera'],

      multiple: false,

      folder: "porchme/gallery",

      maxFileSize: 10_000_000,

      showPoweredBy: false

    }, async (error, result) => {

      if (!error && result && result.event === "success") {

        const url = result.info.secure_url;

        preview.innerHTML = `<img src="${url}" alt="uploaded">`;

        try {

          await fetch(SHEET_WEBAPP_URL, {

            method: "POST",

            headers: {"Content-Type": "application/json"},

            body: JSON.stringify({

              secret: ADMIN_PASSWORD,

              image_url: url,

              title: titleInput.value || "",

              created_at: new Date().toISOString()

            })

          });

          alert("Uploaded & saved ✅ – now visible on Gallery.");

          titleInput.value = "";

        } catch(e){

          alert("Uploaded to Cloudinary, but saving to list failed.");

          console.error(e);

        }

      }

    });



    widget.open();

  });

</script>

</body>

</html>
