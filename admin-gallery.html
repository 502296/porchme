<!doctype html>

<html lang="en">

<head>

  <meta charset="utf-8">

  <title>PorchMe – Admin Gallery</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://upload-widget.cloudinary.com/global/all.js" defer></script>

  <style>

    :root { --card: rgba(255,255,255,.03); --line: rgba(255,255,255,.15); }

    body{background:#0e2340;color:#fff;font-family:system-ui,Segoe UI,Roboto,Arial;margin:0}

    .wrap{max-width:560px;margin:40px auto;padding:24px;border:1px solid var(--line);border-radius:12px;background:var(--card)}

    h2{margin:0 0 10px}

    .row{margin:12px 0}

    input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.06);color:#fff}

    button{padding:12px 18px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:#1b396b;color:#fff;font-weight:600;cursor:pointer}

    .note{opacity:.85;font-size:.9rem;margin-top:8px}

    .thumb img{max-width:100%;border-radius:10px;border:1px solid var(--line)}

  </style>

</head>

<body>

  <div class="wrap">

    <h2>Admin – Upload to Gallery</h2>



    <div class="row">

      <input id="adminPass" type="password" placeholder="Enter admin password">

    </div>



    <div class="row">

      <input id="title" type="text" placeholder="Optional title (e.g., 'Porch example 7')">

    </div>



    <div class="row">

      <button id="uploadBtn">Upload Image</button>

      <div class="note">JPG/PNG/WebP. Large files will be auto-optimized.</div>

    </div>



    <div class="thumb" id="preview"></div>

  </div>



  <script>

    // ===== CONFIG =====

    const CLOUD_NAME       = "dzsear3wr"; // حساب Cloudinary

    const UPLOAD_PRESET    = "porchme_unsigned"; // Unsigned preset

    const SHEET_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbw0N3eKY62Z4q8UnH0FEhRmi3_7jQGuwclHtsU0IgB_mLbWDHW2cnpp64LBW7F6Gnq3/exec";

    const ADMIN_PASSWORD   = "PorchMe2025"; // غيّرها لاحقًا



    const passInput = document.getElementById('adminPass');

    const titleInput = document.getElementById('title');

    const preview = document.getElementById('preview');

    const uploadBtn = document.getElementById('uploadBtn');



    const authed = () => passInput.value === ADMIN_PASSWORD;



    uploadBtn.addEventListener('click', () => {

      if(!authed()){ alert("Wrong password."); return; }



      const widget = cloudinary.createUploadWidget({

        cloudName: CLOUD_NAME,

        uploadPreset: UPLOAD_PRESET,

        sources: ['local','url','camera'],

        multiple: false,

        folder: "porchme/gallery",

        maxFileSize: 10_000_000,

        showPoweredBy: false

      }, async (error, result) => {

        if (error) { console.error(error); alert("Upload error."); return; }

        if (result && result.event === "success") {

          const url = result.info.secure_url;

          preview.innerHTML = `<img src="${url}" alt="uploaded" loading="lazy">`;



          try {

            await fetch(SHEET_WEBAPP_URL, {

              method: "POST",

              headers: {"Content-Type": "application/json", "Cache-Control":"no-cache"},

              body: JSON.stringify({

                secret: ADMIN_PASSWORD,

                image_url: url,

                title: titleInput.value || "",

                created_at: new Date().toISOString()

              })

            });

            alert("Uploaded & saved ✅ – check Recent Work.");

            titleInput.value = "";

          } catch(e){

            console.error(e);

            alert("Uploaded to Cloudinary, but saving to list failed.");

          }

        }

      });



      widget.open();

    });

  </script>

</body>

</html>
