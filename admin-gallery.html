
<!doctype html>

<html lang="en">

<head>

  <meta charset="utf-8">

  <title>PorchMe – Admin Gallery</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://upload-widget.cloudinary.com/global/all.js" defer></script>

  <style>

    body{background:#0e2340;color:#fff;font-family:system-ui,Segoe UI,Roboto,Arial}

    .wrap{max-width:560px;margin:40px auto;padding:24px;border:1px solid rgba(255,255,255,.15);border-radius:12px;background:rgba(255,255,255,.03)}

    button{padding:12px 18px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:#1b396b;color:#fff;font-weight:600;cursor:pointer}

    input,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.06);color:#fff}

    .row{margin:12px 0}

    .thumb{margin-top:14px}

    .thumb img{max-width:100%;border-radius:10px;border:1px solid rgba(255,255,255,.15)}

    .note{opacity:.8;font-size:.9rem;margin-top:8px}

  </style>

</head>

<body>

<div class="wrap">

  <h2>Admin – Upload to Gallery</h2>



  <div class="row">

    <input id="adminPass" type="password" placeholder="Enter admin password">

  </div>



  <div class="row">

    <input id="title" type="text" placeholder="Optional title (e.g., 'Porch example 7')">

  </div>



  <div class="row">

    <button id="uploadBtn">Upload Image</button>

    <div class="note">Allowed: JPG/PNG/WebP. Large files will be auto-optimized.</div>

  </div>



  <div class="thumb" id="preview"></div>

</div>



<script>

  // ==== CONFIG (بدّل القيم بما يخصك) ====

  const CLOUD_NAME = "YOUR_CLOUD_NAME";

  const UPLOAD_PRESET = "porchme_unsigned";  // من Cloudinary

  const SHEET_WEBAPP_URL = "YOUR_APPS_SCRIPT_WEBAPP_URL"; // سننشئه بالأسفل

  const ADMIN_PASSWORD = "PorchMe2025"; // غيّرها فوراً (وللاحتراف: Basic Auth/JWT)



  const passInput = document.getElementById('adminPass');

  const titleInput = document.getElementById('title');

  const preview = document.getElementById('preview');

  const uploadBtn = document.getElementById('uploadBtn');



  function isAuthed(){

    return passInput.value === ADMIN_PASSWORD;

  }



  uploadBtn.addEventListener('click', () => {

    if(!isAuthed()){

      alert("Wrong password.");

      return;

    }

    const myWidget = cloudinary.createUploadWidget({

      cloudName: CLOUD_NAME,

      uploadPreset: UPLOAD_PRESET,

      sources: ['local','url','camera'],

      multiple: false,

      folder: "porchme/gallery",     // اختياري: يرتب الصور داخل فولدر

      maxFileSize: 10_000_000,       // 10MB

      cropping: false,

      showPoweredBy: false

    }, async (error, result) => {

      if (!error && result && result.event === "success") {

        const url = result.info.secure_url;

        preview.innerHTML = `<img src="${url}" alt="uploaded">`;

        // سجّل الرابط في Google Sheet

        try {

          await fetch(SHEET_WEBAPP_URL, {

            method: "POST",

            headers: {"Content-Type": "application/json"},

            body: JSON.stringify({

              secret: ADMIN_PASSWORD,              // بسيط – استبدله بـ token لاحقاً

              image_url: url,

              title: titleInput.value || "",

              created_at: new Date().toISOString()

            })

          });

          alert("Uploaded & saved ✅ – now visible on Gallery page.");

          titleInput.value = "";

        } catch(e){

          alert("Uploaded to Cloudinary, but failed to save to list.");

          console.error(e);

        }

      }

    });



    myWidget.open();

  });

</script>

</body>

</html>
