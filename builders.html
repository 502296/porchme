<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Builder Portal – PorchMe</title>

  <link rel="stylesheet" href="style.css?v=9" />

</head>

<body>

  <div class="topline"></div>



  <nav class="nav">

    <div class="wrap">

      <a class="brand" href="index.html">

        <img src="image/porchme_logo_silver.png" class="royal-logo" alt="PorchMe" />

      </a>

      <button class="nav-toggle" aria-label="Menu">☰</button>

      <div class="nav-links">

        <a class="navlink" href="index.html#expertise">Design Expertise</a>

        <a class="navlink" href="gallery.html">Gallery</a>

        <a class="btn btn-gold" href="book.html">Book a Visit</a>

      </div>

    </div>

  </nav>



  <section class="section">

    <div class="wrap">

      <div class="card">

        <h2>Builder Portal</h2>

        <p class="muted">Complete the form to join our builder network.</p>



        <form id="builder-form" class="form form--grid" method="POST" enctype="multipart/form-data" novalidate>

          <!-- Honeypot -->

          <input type="text" name="company_url" autocomplete="off" tabindex="-1" class="honeypot" />



          <div class="form__item">

            <label class="form__label">Full Name <span class="req">*</span></label>

            <input class="form__control" name="fullName" required />

          </div>



          <div class="form__item">

            <label class="form__label">Company (optional)</label>

            <input class="form__control" name="company" />

          </div>



          <div class="form__item">

            <label class="form__label">Email <span class="req">*</span></label>

            <input class="form__control" type="email" name="email" required />

          </div>



          <div class="form__item">

            <label class="form__label">Phone <span class="req">*</span></label>

            <input class="form__control" type="tel" name="phone" required />

          </div>



          <div class="form__item">

            <label class="form__label">City</label>

            <input class="form__control" name="city" />

          </div>



          <div class="form__item">

            <label class="form__label">State</label>

            <input class="form__control" name="state" />

          </div>



          <div class="form__item">

            <label class="form__label">ZIP Code</label>

            <input class="form__control" name="zip" />

          </div>



          <div class="form__item">

            <label class="form__label">Years of Experience</label>

            <input class="form__control" name="years" />

          </div>



          <div class="form__item">

            <label class="form__label">License / Insurance (optional)</label>

            <input class="form__control form__control--file" name="license" type="file" multiple accept=".pdf,.jpg,.jpeg,.png" />

            <small class="muted">File upload can be enabled later; sending works even without files.</small>

          </div>



          <div class="form__item form__item--span">

            <label class="form__label">Notes (optional)</label>

            <textarea class="form__control" name="notes" rows="3"></textarea>

          </div>



          <label class="check form__item--span">

            <input type="checkbox" id="licensed" name="licensed" required />

            <span>I confirm I’m a licensed/insured contractor and agree to be contacted by PorchMe.</span>

          </label>



          <div class="actions form__item--span">

            <button id="submitBtn" class="btn btn-gold" type="submit" disabled>Request Onboarding</button>

            <button class="btn btn-quiet" type="reset">Clear</button>

          </div>



          <p id="builder-success" class="status muted hidden"></p>

        </form>

      </div>

    </div>

  </section>



  <footer class="footer">

    <div class="wrap">

      <div class="fbrand">

        <img src="image/porchme_logo_silver.png" alt="PorchMe" />

        <strong>PorchMe</strong>

      </div>

      <div class="copy">© 2025 PorchMe. All rights reserved.</div>

    </div>

  </footer>



  <script>

    // رابط الويب-آب الذي أعطيتني إيّاه

    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxL9sAVFSFMwz675dd7UN1w3IlzxWaE71oWsbe8WLjmrvv_5zaOEBk1JDe-5rW-NPI/exec';



    const formEl     = document.getElementById('builder-form');

    const statusEl   = document.getElementById('builder-success');

    const submitBtn  = document.getElementById('submitBtn');

    const licensedCb = document.getElementById('licensed');



    // فعّل الزر فقط عند التأشير

    const syncSubmit = () => submitBtn.disabled = !licensedCb.checked;

    syncSubmit();

    licensedCb.addEventListener('change', syncSubmit);



    // رسالة الحالة

    function showStatus(ok, msg){

      statusEl.classList.remove('hidden');

      statusEl.style.color = ok ? '#8ef5a7' : '#ff8a8a';

      statusEl.textContent = (ok ? '✅ ' : '❌ ') + msg;

    }



    // إرسال FormData بدون ترويسات (يتجاوز CORS/preflight)

    formEl.addEventListener('submit', async (e) => {

      e.preventDefault();



      // honeypot

      const trap = formEl.querySelector('[name="company_url"]');

      if (trap && trap.value) { showStatus(false, 'Blocked (spam)'); return; }



      showStatus(true, 'Submitting...');

      submitBtn.disabled = true;

      submitBtn.textContent = 'Submitting...';



      try {

        const fd = new FormData(formEl);

        const res = await fetch(SCRIPT_URL, { method: 'POST', body: fd }); // لا تضع Content-Type

        // في بعض إعدادات GAS لا يرجع JSON؛ نعتبر نجاح أي 200-299

        if (res.ok) {

          formEl.reset();

          licensedCb.checked = false;

          syncSubmit();

          submitBtn.textContent = 'Request Onboarding';

          showStatus(true, 'Submitted successfully. We will contact you soon.');

        } else {

          const txt = await res.text();

          throw new Error('Server error ' + res.status + ': ' + txt.slice(0,120));

        }

      } catch (err) {

        console.error(err);

        showStatus(false, err.message || 'Failed to send');

        submitBtn.disabled = false;

        submitBtn.textContent = 'Request Onboarding';

      }

    });



    // قائمة الموبايل

    const toggle = document.querySelector('.nav-toggle');

    const links  = document.querySelector('.nav-links');

    if (toggle && links) toggle.addEventListener('click', () => links.classList.toggle('open'));

  </script>

</body>

</html>
