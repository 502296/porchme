<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Builder Portal – PorchMe</title>

  <link rel="stylesheet" href="style.css?v=9" />

</head>

<body>

  <div class="topline"></div>



  <nav class="nav">

    <div class="wrap">

      <a class="brand" href="index.html">

        <img src="image/porchme_logo_silver.png" class="royal-logo" alt="PorchMe" />

      </a>

      <button class="nav-toggle" aria-label="Menu">☰</button>

      <div class="nav-links">

        <a class="navlink" href="index.html#expertise">Design Expertise</a>

        <a class="navlink" href="gallery.html">Gallery</a>

        <a class="btn btn-gold" href="book.html">Book a Visit</a>

      </div>

    </div>

  </nav>



  <section class="section">

    <div class="wrap">

      <div class="card">

        <h2>Builder Portal</h2>

        <p class="muted">Materials for licensed builders partnering with PorchMe.</p>



        <div class="btn-row" style="margin-top:12px">

          <a class="btn btn-outline" href="files/Builder_Guide.pdf" target="_blank" rel="noopener">Download Builder Guide (PDF)</a>

          <a class="btn btn-outline" href="files/Standard_Specs.pdf" target="_blank" rel="noopener">Standard Specs (PDF)</a>

        </div>



        <hr class="divider" />



        <h3 class="h3">Request Onboarding</h3>

        <p class="muted">Interested in partnering with PorchMe? Complete the form below to join our builder network.</p>



        <!-- IMPORTANT: action + method + enctype موجودة -->

        <form id="builderForm"

              class="form form--grid"

              action="https://script.google.com/macros/s/AKfycbxLv7HbgL8RV2DwFlgsvJ8CRVQS06P4gSqClQwr-k16yOpUJNvj2IDpGT_-euIVh1bd/exec"

              method="POST"

              enctype="multipart/form-data">



          <!-- honeypot -->

          <input type="text" name="company_url" autocomplete="off" tabindex="-1" class="honeypot" />



          <div class="form__item">

            <label class="form__label">Full Name <span class="req">*</span></label>

            <input class="form__control" name="fullName" required placeholder="Your name" />

          </div>



          <div class="form__item">

            <label class="form__label">Company (optional)</label>

            <input class="form__control" name="company" placeholder="Company name" />

          </div>



          <div class="form__item">

            <label class="form__label">Email <span class="req">*</span></label>

            <input class="form__control" type="email" name="email" required placeholder="you@example.com" />

          </div>



          <div class="form__item">

            <label class="form__label">Phone <span class="req">*</span></label>

            <input class="form__control" type="tel" name="phone" required placeholder="(502) 123-4567" />

          </div>



          <div class="form__item">

            <label class="form__label">Work Area (City) <span class="req">*</span></label>

            <input class="form__control" name="workArea" required placeholder="Louisville" />

          </div>



          <div class="form__item">

            <label class="form__label">ZIP Code <span class="req">*</span></label>

            <input class="form__control" name="zip" required placeholder="40218" />

          </div>



          <div class="form__item">

            <label class="form__label">Years of Experience <span class="req">*</span></label>

            <input class="form__control" name="yearsExperience" required placeholder="e.g., 8" />

          </div>



          <div class="form__item">

            <label class="form__label">License / Insurance (PDF/JPG/PNG) – optional</label>

            <!-- name يجب أن يكون 'license' ليُحفظ في Drive -->

            <input class="form__control form__control--file" name="license" type="file" multiple accept=".pdf,.jpg,.jpeg,.png" />

          </div>



          <div class="form__item form__item--span">

            <label class="form__label">Notes (optional)</label>

            <textarea class="form__control" name="notes" rows="4" placeholder="Tell us about specialties, crew size, coverage area…"></textarea>

          </div>



          <label class="check form__item--span">

            <input type="checkbox" id="agree" name="agree" required />

            <span>I confirm I’m a licensed/insured contractor and agree to be contacted by PorchMe.</span>

          </label>



          <div class="actions form__item--span">

            <button id="submitBtn" class="btn btn-gold" type="submit">Request Onboarding</button>

            <button class="btn btn-quiet" type="reset">Clear</button>

          </div>



          <p id="status" class="status muted"></p>

        </form>

      </div>

    </div>

  </section>



  <footer class="footer">

    <div class="wrap">

      <div class="fbrand">

        <img src="image/porchme_logo_silver.png" alt="PorchMe" />

        <strong>PorchMe</strong>

      </div>

      <div class="copy">© 2025 PorchMe. All rights reserved.</div>

    </div>

  </footer>



  <!-- ===== JS ===== -->

  <script>

    // نفس الرابط في action لا مشكلة؛ نستخدمه هنا أيضًا مع fetch

    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxLv7HbgL8RV2DwFlgsvJ8CRVQS06P4gSqClQwr-k16yOpUJNvj2IDpGT_-euIVh1bd/exec';



    const formEl    = document.getElementById('builderForm');

    const statusEl  = document.getElementById('status');

    const submitBtn = document.getElementById('submitBtn');

    const agree     = document.getElementById('agree');



    // اختياري: منع الإرسال قبل الموافقة

    submitBtn.disabled = true;

    agree.addEventListener('change', () => submitBtn.disabled = !agree.checked);



    formEl.addEventListener('submit', async (e) => {

      // سنحاول الإرسال عبر fetch أولاً (AJAX)

      e.preventDefault();

      statusEl.classList.remove('error');

      statusEl.textContent = '';

      submitBtn.disabled = true;

      submitBtn.textContent = 'Submitting...';



      try {

        const fd  = new FormData(formEl);

        const res = await fetch(SCRIPT_URL, { method: 'POST', body: fd });



        const text = await res.text();

        let data = {};

        try { data = JSON.parse(text); } catch (_) { /* ignore */ }



        // ✅ يتوافق مع Code.gs: { result: 'success' }

        if (res.ok && data.result === 'success') {

          // إعادة التعيين أو تحويل لصفحة شكر

          formEl.reset();

          agree.checked = false;

          submitBtn.disabled = true;

          submitBtn.textContent = 'Request Onboarding';

          statusEl.style.color = '#8ef5a7';

          statusEl.textContent = '✅ Submitted successfully. We will contact you soon.';

          return;

        }



        throw new Error((data && data.message) ? data.message : ('Server error: ' + text.slice(0, 200)));

      } catch (err) {

        // عرض الخطأ للمستخدم

        statusEl.classList.add('error');

        statusEl.style.color = '#ff8a8a';

        statusEl.textContent = '❌ ' + (err.message || String(err));

        console.error('[Submission error]', err);



        // فallback: لو فشل fetch بسبب CORS/نت، أرسل بالطريقة التقليدية

        submitBtn.disabled = false;

        submitBtn.textContent = 'Request Onboarding';

        formEl.submit(); // يرسل عبر action مباشرة

      }

    });



    // قائمة الموبايل

    const toggle = document.querySelector('.nav-toggle');

    const links  = document.querySelector('.nav-links');

    if (toggle && links) toggle.addEventListener('click', () => links.classList.toggle('open'));

  </script>

</body>

</html>
